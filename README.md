# RL Antiyoy Game 
# Участники
- Богданов Ярослав
- Ильин Павел
- Тураянов Денис
- Шаяхметов Аскар

# Инструкция по запуску
### Запуск API и инструментов

В файле `default.env` указан порт API-сервера и число воркеров:

EXTERNAL_PORT=<адрес сервера>\
GUNICORN_WORKERS=<число воркеров>

Запуск:

```bash
docker-compose -f docker-compose.yml --env-file default.env up
```

### Запуск игрового сервера

В файле `default.env` указан порт игрового сервера:

EXTERNAL_PORT_GAMESERVER=<адрес игрового сервера>\
GUNICORN_WORKERS=<число воркеров>

Запуск:

```bash
docker compose -f docker-compose.gameserver.yml --env-file default.env up --build
```

### Демо (иногда работает)
- [Проигрыватель логов с записью игры mcst](http://gameapi.afsh.space/log_player/demo/)
- [Редактор gamestate](http://gameapi.afsh.space/state_editor/)
- [Игровой сервер](http://antiyoygame.afsh.space/)


### Описание данных

Логи игры хранятся в лог-файлах. Каждый ход — это одна строка с JSON-объектом `gamestate`.

Описание структуры объекта находится здесь:

http://gameapi.afsh.space/docs

# Правила игры

## Основы
- Карта состоит из гексагональных ячеек.
- У каждого игрока есть база из 8 соединённых ячеек, одна из которых — ратуша.
- Начальный запас: 100 монет.
- Доход за ход = количество захваченных ячеек + бонусы от ферм.
- Захват ячеек: юнит перемещается на нейтральную/вражескую ячейку в радиусе доступности (4), если она не заблокирована башней либо вражеским юнитом.

## Здания
- **Ферма**:
  - Стоимость: 12 + 2 × [число уже купленных ферм игрока].
  - Доход: +4 монеты/ход.
  - Условие: ставится в радиусе 1 от ратуши или другой фермы на своей ячейке.
- **Слабая башня**:
  - Стоимость: 15 монет, обслуживание: 1/ход.
  - Эффект: блокирует юнитов < 3 уровня в радиусе 1 (только на своих ячейках).
- **Сильная башня**:
  - Стоимость: 35 монет, обслуживание: 6/ход.
  - Эффект: блокирует юнитов < 4 уровня в радиусе 1 (только на своих ячейках).
- Примечание: здания не исчезают при отрицательном балансе монет.

## Юниты
- Уровни и стоимость:
  - Уровень 1: 10 монет, обслуживание 2/ход.
  - Уровень 2: 20 монет, обслуживание 4/ход.
  - Уровень 3: 30 монет, обслуживание 12/ход.
  - Уровень 4: 40 монет, обслуживание 18/ход.
- Защита: юнит уровня N блокирует юнитов уровня ≤ N в радиусе 1 (только на своих ячейках) (кроме 4 против 4).
- Перемещение: радиус 4 по своим ячейкам. Нейтральные/вражеские ячейки доступны для захвата, но ветка обрезается. Защищённые ячейки недоступны.
- Первый ход: только покупка, без обслуживания.
- Склеивание:
  - Уровень = min(4, сумма уровней).
  - Второй юнит должен быть в радиусе 4 от первого.
  - Итоговый юнит стоит на месте второго и может ходить снова.

## Механика хода
- Покупка зданий и юнитов в пределах доступных монет.
- Юнит ходит 1 раз за ход (радиус 4). Склеивание считается ходом.
- Если монеты уходят в минус из-за обслуживания, все юниты исчезают, запас = 0.

## Ратуша
- Если враг встаёт на ратушу, она перемещается в случайную дружественную ячейку.
- База — это 8 захваченных ячеек, ратуша — одна из них.

## Условия игры
- Проигрыш: потеря всех ячеек.
- Победа: уничтожение всех ячеек противника.

---

# Пример первого хода

## Условия
- База: 8 ячеек.
- Монеты: 100.
- Цель: экономика + лёгкая экспансия.

## Действия
1. **Доход**: 8 ячеек = 8 монет/ход.
2. **Покупки**:
   - **2 фермы**:
     - Первая: 12 монет (+4 доход).
     - Вторая: 14 монет (12 + 2 × 1) (+4 доход).
     - Итого: 26 монет, доход = 8 + 4 + 4 = 16 монет/ход.
     - Ставим рядом с ратушей.
   - **Слабая башня**: 15 монет, обслуживание 1/ход. Ставим у ратуши.
   - **Юнит 2 уровня**: 20 монет, обслуживание 4/ход. Ставим на краю базы.
3. **Расходы**: 26 + 15 + 20 = 61 монета.
4. **Остаток**: 100 - 61 = 39 монет.
5. **Перемещение**:
   - Юнит 2 уровня идёт на 4 ячейки и захватывает нейтральную ячейку.
   - Итог: 9 ячеек.

## Итог
- 9 ячеек, 2 фермы, 1 слабая башня, 1 юнит 2 уровня.
- Монеты: 39.
- Следующий ход: доход 17 (9 + 8), расходы 5 (4 + 1), прибыль +12, итого 51 монета.
